@model FiveStars.Models.MovieFilterViewModel

@{
    ViewBag.Title = "Movies";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="movies-page container">

    <!-- ÜST BAŞLIK + FİLTRELER -->
    <div class="movies-header-row">
        <h1 class="movies-title">MOVIES</h1>

        <form id="movies-filter-form"
              method="get"
              action="@Url.Action("Index", "Movies")"
              class="movies-filter-form">

            <!-- SEARCH -->
            <div class="movies-search-wrapper">
                <i class="fas fa-search movies-search-icon"></i>
                <input type="text"
                       name="searchTerm"
                       class="movies-search-input"
                       placeholder="Search movie..."
                       value="@Model.SearchTerm" />
            </div>

            <!-- GENRE -->
            <div class="movies-filter-group">
                <label for="genreSelect" class="movies-filter-label">GENRE</label>
                <select id="genreSelect"
                        name="genreId"
                        class="movies-filter-select">
                    <option value="">All</option>
                    @foreach (var g in Model.Genres)
                    {
                        <option value="@g.GenreID"
                                @(Model.SelectedGenreId == g.GenreID ? "selected" : "")>
                            @g.Name
                        </option>
                    }
                </select>
            </div>

            <!-- CINEMA -->
            <div class="movies-filter-group">
                <label for="cinemaSelect" class="movies-filter-label">CINEMA</label>
                <select id="cinemaSelect"
                        name="cinemaId"
                        class="movies-filter-select">
                    <option value="">All</option>
                    @foreach (var c in Model.Cinemas)
                    {
                        <option value="@c.CinemaID"
                                @(Model.SelectedCinemaId == c.CinemaID ? "selected" : "")>
                            @c.CinemaName
                        </option>
                    }
                </select>
            </div>

           
        </form>
    </div>

    <!-- FİLM GRIDİ -->
    <div class="movies-grid">
        @if (Model.Movies == null || !Model.Movies.Any())
        {
            <div class="movies-no-results">
                No movies found for selected filters.
            </div>
        }
        else
        {
            foreach (var movie in Model.Movies)
            {
                // Poster yolu
                var posterPath = Url.Content("~/" + (string.IsNullOrEmpty(movie.PosterUrl)
                    ? "images/default-poster.jpg"
                    : movie.PosterUrl));

                // Status badge sınıfı + yazısı
                string badgeClass;
                string statusText;

                switch (movie.Status)
                {
                    case "Now Showing":
                        badgeClass = "badge-now";
                        statusText = "NOW SHOWING";
                        break;
                    case "Coming Soon":
                        badgeClass = "badge-coming";
                        statusText = "COMING SOON";
                        break;
                    default:
                        badgeClass = "badge-archived";
                        statusText = "ARCHIVED";
                        break;
                }

                <div class="movie-card">
                    <!-- POSTER -->
                    <div class="movie-card-poster">
                        <a href="@Url.Action("Details", "Movies", new { id = movie.MovieID })">
                            <img src="@posterPath" alt="@movie.Title" />
                        </a>
                    </div>

                    <!-- ALT SİYAH BLOK -->
                    <div class="movie-card-body">
                        <!-- BAŞLIK -->
                        <div class="movie-card-title">
                            <a href="@Url.Action("Details", "Movies", new { id = movie.MovieID })">
                                @movie.Title
                            </a>
                        </div>

                        <!-- ÇIKIŞ TARİHİ -->
                        <div class="movie-card-meta">
                            @if (movie.ReleaseDate.HasValue)
                            {
                                @:Release date @movie.ReleaseDate.Value.ToString("dd.MM.yyyy")
                            }
                            else
                            {
                                @:Release date TBA
                            }
                        </div>

                        <!-- SÜRE -->
                        <div class="movie-card-meta">
                            Duration: @movie.Duration_min min
                        </div>

                        <!-- RATING + STATUS + BOOK NOW -->
                        <div class="movie-card-rating">
                            @if (movie.Ratings.HasValue)
                            {
                                <span>⭐ @movie.Ratings.Value.ToString("0.0") / 10</span>
                            }

                            <span class="movie-status-badge @badgeClass">
                                @statusText
                            </span>

                            @* SADE, BEYAZ YAZILI BOOK NOW – SADECE NOW SHOWING İÇİN *@
                            @if (movie.Status == "Now Showing")
                            {
                                <a href="@Url.Action("Details", "Movies", new { id = movie.MovieID })"
                                   style="margin-left:auto;
                                          font-size:11px;
                                          text-transform:uppercase;
                                          color:#ffffff;
                                          border:1px solid #fff;
                                          padding:2px 10px;
                                          border-radius:999px;
                                          text-decoration:none;">
                                    BOOK&nbsp;NOW
                                </a>
                            }
                        </div>
                    </div>
                </div>
            }
        }
    </div>
</div>
