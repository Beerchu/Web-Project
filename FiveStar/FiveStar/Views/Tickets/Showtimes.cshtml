@model FiveStars.Models.ShowtimeSelectionViewModel

@{
    ViewBag.Title = "Select Showtime";
    Layout = "~/Views/Shared/_Layout.cshtml";

    // Poster yolu
    var posterPath = Url.Content("~/" + (string.IsNullOrEmpty(Model.PosterUrl)
        ? "images/default-poster.jpg"
        : Model.PosterUrl));

    // Sadece "Now Showing" ise yeşil badge
    bool isNowShowing = string.Equals(
        Model.Status?.Trim(),
        "Now Showing",
        System.StringComparison.OrdinalIgnoreCase);
}

@section Styles {
    <!-- Detail stilleri + Showtime stilleri -->
    <link rel="stylesheet" href="@Url.Content("~/Content/detail.css")" />
    <link rel="stylesheet" href="@Url.Content("~/Content/showtime.css")" />
}

<div class="movie-detail-page showtime-page container">

    <!-- ÜST KISIM: detail sayfası ile aynı yapı -->
    <div class="movie-detail-hero showtime-header">

        <!-- SOL: bilgi alanı -->
        <div class="movie-detail-info">

            <div class="movie-detail-status-row">
                @if (isNowShowing)
                {
                    <span class="movie-status-badge badge-now">NOW SHOWING</span>
                }
                else if (string.Equals(Model.Status, "Coming Soon", System.StringComparison.OrdinalIgnoreCase))
                {
                    <span class="movie-status-badge badge-coming">COMING SOON</span>
                }
                else
                {
                    <span class="movie-status-badge badge-archived">ARCHIVED</span>
                }
            </div>

            <h1 class="movie-detail-title">@Model.MovieTitle</h1>

            <p class="movie-detail-description">
                Please select a cinema and time for your movie.
            </p>

            <div class="movie-detail-actions">
                <a class="movie-detail-btn-secondary"
                   href="@Url.Action("Index", "Home")">
                    BACK TO HOME
                </a>

                <a class="movie-detail-btn-ghost"
                   href="@Url.Action("Index", "Movies")">
                    ← Back to Movies
                </a>
            </div>
        </div>

        <!-- SAĞ: poster -->
        <div class="movie-detail-poster showtime-poster">
            <img src="@posterPath" alt="@Model.MovieTitle" />
        </div>
    </div>

    <!-- ALT KISIM: SINEMA + SAAT BUTONLARI -->
    <div class="showtime-list">
        @if (Model.Showtimes == null || !Model.Showtimes.Any())
        {
            <p>No showtimes found for this movie.</p>
        }
        else
        {
            @* Önce güne göre grupla *@
            foreach (var dayGroup in Model.Showtimes
                                         .OrderBy(s => s.ShowTime)
                                         .GroupBy(s => s.ShowTime.Date))
            {
                <div class="showtime-day-block">

                    <h2 class="showtime-section-title">
                        @dayGroup.Key.ToString("dddd, dd MMMM yyyy")
                    </h2>

                    @* Her gün içinde sinemaya göre grupla *@
                    @foreach (var cinemaGroup in dayGroup.GroupBy(s => s.CinemaName))
                    {
                        <div class="cinema-block">
                            <h3 class="cinema-name">@cinemaGroup.Key</h3>

                            <div class="showtime-chips">
                                @foreach (var s in cinemaGroup)
                                {
                                    <a class="showtime-chip"
                                       href="@Url.Action(
                                           "SelectSeats",   // koltuk seçme action’ın adı
                                           "Tickets",
                                           new { showingId = s.ShowingId }  // ViewModel’deki property adına göre gerekirse değiştir
                                       )">
                                        <span class="showtime-chip-time">
                                            @s.ShowTime.ToString("HH:mm")
                                        </span>
                                       
                                    </a>
                                }
                            </div>
                        </div>
                    }
                </div>
            }
        }
    </div>
</div>
