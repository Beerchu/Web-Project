@model FiveStars.Models.ShowtimeSelectionViewModel

@{
    ViewBag.Title = "Select Showtime";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var posterPath = Url.Content("~/" + (string.IsNullOrEmpty(Model.PosterUrl)
        ? "images/default-poster.jpg"
        : Model.PosterUrl));

    bool isNowShowing = string.Equals(
        Model.Status?.Trim(),
        "Now Showing",
        System.StringComparison.OrdinalIgnoreCase);
}

@section Styles {
    <link rel="stylesheet" href="@Url.Content("~/Content/showtime.css")" />
}

<div class="movie-detail-page showtime-page container">

    <div class="showtime-layout">

        <!-- SOL: Film bilgisi + seans listesi -->
        <div class="showtime-main">

            <div class="showtime-top">
                <div class="movie-detail-status-row">
                    @if (isNowShowing)
                    {
                        <span class="movie-status-badge badge-now">NOW SHOWING</span>
                    }
                    else if (string.Equals(Model.Status, "Coming Soon", System.StringComparison.OrdinalIgnoreCase))
                    {
                        <span class="movie-status-badge badge-coming">COMING SOON</span>
                    }
                    else
                    {
                        <span class="movie-status-badge badge-archived">ARCHIVED</span>
                    }
                </div>

                <h1 class="movie-detail-title">@Model.MovieTitle</h1>

                <p class="showtime-subtitle">
                    Please select a cinema and time for your movie.
                </p>

                <div class="showtime-actions">
                    <a class="btn btn-primary" href="@Url.Action("Index", "Home")">
                        BACK TO HOME
                    </a>

                    <a class="btn btn-ghost" href="@Url.Action("Index", "Movies")">
                        ← Back to Movies
                    </a>
                </div>

            </div>

            <div class="showtime-list">
                @if (Model.Showtimes == null || !Model.Showtimes.Any())
                {
                    <p class="showtime-empty">No showtimes found for this movie.</p>
                }
                else
                {
                    foreach (var dayGroup in Model.Showtimes
                                                 .OrderBy(s => s.ShowTime)
                                                 .GroupBy(s => s.ShowTime.Date))
                    {
                        <div class="showtime-day-block">
                            <h2 class="showtime-section-title">
                                @dayGroup.Key.ToString("dddd, dd MMMM yyyy")
                            </h2>

                            @foreach (var cinemaGroup in dayGroup
                                                       .GroupBy(s => s.CinemaName)
                                                       .OrderBy(g => g.Key))
                            {
                                <div class="cinema-block">
                                    <h3 class="cinema-name">@cinemaGroup.Key</h3>

                                    <div class="showtime-chips">
                                        @foreach (var s in cinemaGroup.OrderBy(x => x.ShowTime))
                                        {
                                            <a class="showtime-chip"
                                               href="@Url.Action("SelectSeats", "Tickets", new { showingId = s.ShowingId })">
                                                <span class="showtime-chip-time">
                                                    @s.ShowTime.ToString("HH:mm")
                                                </span>
                                            </a>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    }
                }
            </div>

        </div>

        <!-- SAĞ: Sticky poster -->
        <aside class="showtime-aside">
            <div class="showtime-poster-card">
                <img src="@posterPath" alt="@Model.MovieTitle" />
            </div>
        </aside>

    </div>

</div>
